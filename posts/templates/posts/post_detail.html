<h1>{{ post.title }}</h1>
<p>{{ post.content }}</p>
<p>
    Author: {{ post.author.username }} | 
    Created: {{ post.created_at|date:"M d, Y H:i" }}
</p>
<div class="comments-section">
    <h3>Comments</h3>
    <div class="comment-form">
        <h3>Leave a Comment</h3>
        <form method="post" action="{% url 'add_comment' post.id %}">
            {% csrf_token %}
            <textarea name="content" rows="4" placeholder="Write your comment here..." class="form-control"></textarea>
            <button type="submit" class="btn btn-primary mt-2">Post Comment</button>
        </form>
    </div>
    <ul>
        {% for comment in top_level_comments %}
            <li>
                <p>
                    <strong>
                        {% if comment.user %}
                            {{ comment.user.username }}
                        {% else %}
                            {{ comment.bot }}
                        {% endif %}
                    </strong>: {{ comment.content }}
                </p>
                <a href="{% url 'reply_to_comment' comment.id %}">Reply</a>
                
                <!-- Display replies -->
                {% if comment.replies.exists %}
                    <ul>
                        {% for reply in comment.replies.all %}
                            <li>
                                <p>
                                    <strong>
                                        {% if reply.user %}
                                            {{ reply.user.username }}
                                        {% else %}
                                            {{ reply.bot }}
                                        {% endif %}
                                    </strong>: {{ reply.content }}
                                </p>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
</div>
